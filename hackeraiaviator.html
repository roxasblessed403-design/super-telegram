<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoXaSB_SPINCITY_SYNC</title>
    <style>
        :root { --gold: #ffcc00; --purple: #bc13fe; --bg: #050505; --red: #ff4444; --green: #00ff88; --cyan: #00f2ff; }
        body { font-family: 'Courier New', monospace; background-color: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; overflow-x: hidden; min-height: 100vh; }
        
        #offlineOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 3000; flex-direction: column; align-items: center; justify-content: center; color: var(--red); text-align: center; border: 4px solid var(--red); }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .card { background: #0a0a0a; border: 1px solid #333; padding: 20px; border-radius: 12px; width: 90%; max-width: 420px; box-shadow: 0 0 40px rgba(188, 19, 254, 0.15); display: none; border-top: 4px solid var(--purple); margin: 20px 0; }

        .goal-box { background: #111; padding: 12px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; text-align: center; }
        .money-input { background: #000; border: 1px solid var(--cyan); color: var(--gold); padding: 8px; border-radius: 4px; width: 50%; text-align: center; outline: none; }

        .stats-bar { display: flex; justify-content: space-around; background: #111; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; }
        .stat-val { display: block; font-weight: bold; font-size: 16px; }
        .stat-label { font-size: 9px; color: #666; }

        .terminal { background: #000; padding: 10px; font-size: 11px; color: var(--cyan); height: 60px; border-left: 3px solid var(--cyan); margin: 15px 0; overflow: hidden; }

        .sync-status { font-size: 9px; color: var(--green); margin-bottom: 5px; }
        .prediction-list { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .prediction-item { border: 1px solid #222; padding: 12px; background: rgba(188, 19, 254, 0.05); border-radius: 8px; margin-bottom: 10px; border-top: 2px solid var(--purple); transition: 0.3s; position: relative; }
        .active-window { border-color: var(--green); box-shadow: 0 0 15px var(--green); animation: pulse 1s infinite; }
        .crashed { border-color: var(--red); box-shadow: 0 0 15px var(--red); }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .multiplier-tag { background: #000; padding: 8px; border-radius: 4px; border: 1px solid #222; flex: 1; text-align: center; margin: 0 5px; }
        .real-multiplier { background: var(--green); color: black; font-weight: bold; }
        
        .hack-btn { background: var(--purple); color: #fff; border: none; padding: 18px; font-size: 16px; font-weight: 900; width: 100%; cursor: pointer; border-radius: 8px; text-transform: uppercase; letter-spacing: 2px; }
        .hack-btn:disabled { background: #222; color: #555; cursor: not-allowed; }
        
        .log-btn { flex: 1; padding: 10px; border-radius: 5px; cursor: pointer; font-family: inherit; font-weight: bold; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--purple); border-radius: 10px; }
    </style>
</head>
<body>

<div id="offlineOverlay">
    <h1 style="font-size: 60px; margin: 0;">⚡</h1>
    <h2 style="letter-spacing: 3px;">SIGNAL_LOST</h2>
    <p style="font-size: 10px; color: #666;">CHECK DATA CONNECTION</p>
</div>

<div id="loginOverlay">
    <div style="text-align:center; padding:30px; border:1px solid var(--purple); border-radius:15px; background:#0a0a0a;">
        <h2 style="color: var(--purple); margin:0;">SPINCITY_SYNC_v23.1</h2>
        <input type="password" id="accessKey" style="background:#000; border:1px solid #444; color:var(--gold); padding:12px; width:180px; text-align:center; margin:15px 0;" placeholder="ACCESS KEY"><br>
        <button class="hack-btn" onclick="validateKey()" style="padding:10px 30px; font-size:12px;">AUTHORIZE</button>
        <p style="font-size:8px; color:#666; margin-top:10px;">AUTO-SYNC: spincity.co.zw/Aviator</p>
    </div>
</div>

<div class="card" id="mainCard">
    <div class="goal-box">
        <span style="font-size: 9px; color: var(--cyan);">DAILY_WIN_TARGET</span><br>
        <input type="number" id="goalInput" class="money-input" placeholder="0" onchange="saveSession()">
    </div>

    <div class="stats-bar">
        <div class="stat-item"><span class="stat-val" id="winCount" style="color:var(--green)">0</span><span class="stat-label">WINS</span></div>
        <div class="stat-item"><span class="stat-val" id="lossCount" style="color:var(--red)">0</span><span class="stat-label">LOSSES</span></div>
        <div class="stat-item"><span class="stat-val" id="winRate" style="color:var(--cyan)">0%</span><span class="stat-label">ACCURACY</span></div>
        <div class="stat-item"><span class="stat-val" id="syncStatus" style="color:var(--purple)">OFFLINE</span><span class="stat-label">SYNC</span></div>
    </div>

    <div class="sync-status" id="syncStatusLine">SPINCITY MONITOR: OFFLINE</div>

    <select id="betSite" onchange="updateStatus()" style="width:100%; background:#000; color:var(--gold); border:1px solid #333; padding:12px; border-radius:5px; margin-bottom:10px;">
        <option value="SPIN CITY">SPIN CITY AVIATOR ✓</option>
    </select>

    <div id="liveClock" style="font-size: 30px; text-align: center; color: var(--gold); margin-bottom: 10px;">00:00:00</div>
    <div class="terminal" id="terminal">> AWAITING SPINCITY CONNECTION...</div>

    <div id="results" class="prediction-list"></div>
    
    <button class="hack-btn" id="activateBtn" onclick="manualSync()">FORCE SYNC</button>

    <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="log-btn" onclick="logResult(true)" style="background:#00ff8822; color:var(--green); border:1px solid var(--green);">✓ CASHED OUT</button>
        <button class="log-btn" onclick="logResult(false)" style="background:#ff444422; color:var(--red); border:1px solid var(--red);">✗ CRASHED</button>
    </div>
    
    <p onclick="resetSession()" style="text-align:center; font-size:8px; color:#333; margin-top:15px; cursor:pointer;">WIPE_LOCAL_MEMORY</p>
</div>

<script>
    const AUTH_KEY = "20060927";
    let stats = JSON.parse(localStorage.getItem('v23_stats')) || { wins: 0, losses: 0, crashes: [] };
    let predictions = [];
    let isSynced = false;
    let crashObserver = null;
    const synth = window.speechSynthesis;

    function speak(text) {
        if (synth.speaking) synth.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.pitch = 0.8; utter.rate = 1.0;
        synth.speak(utter);
    }

    function validateKey() {
        if (document.getElementById('accessKey').value === AUTH_KEY) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainCard').style.display = 'block';
            loadSession();
            initSpinCitySync();
            speak("SpinCity sync authorized. Monitoring Aviator...");
        }
    }

    function initSpinCitySync() {
        // Check if on SpinCity page
        if (window.location.href.includes('spincity.co.zw/games/Aviator')) {
            startAviatorMonitor();
        } else {
            document.getElementById('syncStatusLine').innerHTML = 'SPINCITY MONITOR: <span style="color:var(--red);">NOT ON AVIATOR PAGE</span>';
            document.getElementById('syncStatus').innerText = 'PAGE';
        }
        
        // Auto-sync every 5s
        setInterval(autoSyncCheck, 5000);
    }

    function startAviatorMonitor() {
        document.getElementById('syncStatus').innerText = 'LIVE';
        document.getElementById('syncStatusLine').innerHTML = 'SPINCITY AVIATOR: <span style="color:var(--green);">SYNCED ✓</span>';
        isSynced = true;
        
        // Monitor DOM changes for multiplier/crash
        crashObserver = new MutationObserver(detectCrash);
        crashObserver.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['class', 'style', 'textContent']
        });
        
        speak("Live sync established.");
        document.getElementById('terminal').innerHTML = '> SPINCITY_AVIATOR_LIVE';
    }

    function detectCrash(mutations) {
        mutations.forEach((mutation) => {
            // Common SpinCity Aviator selectors (adjust after inspection)
            const multiplierEls = document.querySelectorAll('.multiplier, .crash-value, [class*="multiplier"], [class*="crash"], .coefficient, .multi');
            multiplierEls.forEach(el => {
                const text = el.textContent || el.innerText;
                const multMatch = text.match(/(\d+\.?\d*)x?/i);
                if (multMatch) {
                    const multiplier = parseFloat(multMatch[1]);
                    if (multiplier >= 999 || el.classList.contains('crashed') || el.style.color === 'red') {
                        handleRealCrash(multiplier);
                    }
                }
            });
        });
    }

    function handleRealCrash(multiplier) {
        if (!isSynced) return;
        
        speak(`Crash detected: ${multiplier.toFixed(2)}x`);
        document.getElementById('terminal').innerHTML = `> CRASH: ${multiplier.toFixed(2)}x | SYNCED`;
        
        // Update active prediction
        const activePred = predictions.find(p => !p.played && !p.crashed);
        if (activePred) {
            const predId = `pred-${activePred.target.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}`;
            const predEl = document.getElementById(predId);
            if (predEl) {
                predEl.classList.remove('active-window');
                predEl.classList.add('crashed');
                
                // Add real multiplier
                const multTags = predEl.querySelectorAll('.multiplier-tag');
                if (multTags[1]) {
                    multTags[1].innerHTML = `<span class="real-multiplier">${multiplier.toFixed(2)}x REAL</span>`;
                }
            }
            activePred.crashed = true;
            activePred.realMultiplier = multiplier;
            
            stats.crashes.push({
                time: new Date().toISOString(),
                multiplier: multiplier,
                predictedLow: multiplier < 3.0
            });
        }
        
        // Schedule next prediction (typical 60-90s round)
        setTimeout(() => {
            getNextPrediction();
        }, 45000); // 45s after crash
    }

    function getNextPrediction() {
        const now = new Date();
        const nextRound = new Date(now.getTime() + 60000); // +1 min
        
        predictions.push({
            target: nextRound,
            id: `timer-${predictions.length + 1}`,
            played: false,
            crashed: false
        });

        const resultsDiv = document.getElementById('results');
        const startStr = nextRound.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        const end = new Date(nextRound);
        end.setMinutes(end.getMinutes() + 1);
        const endStr = end.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

        resultsDiv.innerHTML += `
            <div class="prediction-item" id="pred-${startStr}">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <span style="font-size: 9px; color: var(--purple);">SYNC_ROUND_${predictions.length}</span>
                    <span id="timer-${predictions.length}" style="font-size: 10px; color: var(--cyan); font-weight:bold;">01:00</span>
                </div>
                <div style="font-size: 20px; font-weight: bold;">${startStr} <span style="color:var(--purple); font-size:12px;">TO</span> ${endStr}</div>
                <div style="display:flex; justify-content:space-between; margin-top:8px;">
                    <div class="multiplier-tag"><span style="color:var(--green); font-size:14px;">${(Math.random()*0.5+1.8).toFixed(2)}x</span></div>
                    <div class="multiplier-tag"><span style="color:var(--red); font-size:14px;">${(Math.random()*10+4).toFixed(2)}x</span></div>
                </div>
            </div>`;
            
        resultsDiv.scrollTop = resultsDiv.scrollHeight;
    }

    function manualSync() {
        getNextPrediction();
        speak("Manual sync initiated.");
    }

    function autoSyncCheck() {
        if (window.location.href.includes('spincity.co.zw/games/Aviator') && !isSynced) {
            startAviatorMonitor();
        }
    }

    // Original functions (unchanged except saveSession)
    function saveSession() {
        stats.crashes = stats.crashes.slice(-50); // Keep last 50 crashes
        localStorage.setItem('v23_stats', JSON.stringify(stats));
        localStorage.setItem('v23_goal', document.getElementById('goalInput').value);
        checkGoalStatus();
    }

    function loadSession() {
        document.getElementById('winCount').innerText = stats.wins;
        document.getElementById('lossCount').innerText = stats.losses;
        document.getElementById('goalInput').value = localStorage.getItem('v23_goal') || "";
        updateStatsDisplay();
    }

    function logResult(win) {
        if(win) stats.wins++; else stats.losses++;
        saveSession();
        updateStatsDisplay();
        speak(win ? "Cashout logged." : "Bust logged.");
    }

    function updateStatsDisplay() {
        document.getElementById('winCount').innerText = stats.wins;
        document.getElementById('lossCount').innerText = stats.losses;
        const total = stats.wins + stats.losses;
        document.getElementById('winRate').innerText = total ? ((stats.wins / total) * 100).toFixed(0) + "%" : "0%";
        checkGoalStatus();
    }

    function resetSession() {
        if(confirm("Confirm wipe?")) { 
            stats = { wins: 0, losses: 0, crashes: [] }; 
            localStorage.clear(); 
            location.reload();
        }
    }

    function checkGoalStatus() {
        const goal = parseInt(document.getElementById('goalInput').value);
        if (goal > 0 && stats.wins >= goal) {
            speak("Target reached.");
            document.getElementById('activateBtn').disabled = true;
            document.getElementById('activateBtn').innerText = "GOAL_REACHED";
        } else {
            document.getElementById('activateBtn').disabled = false;
            document.getElementById('activateBtn').innerText = "FORCE SYNC";
        }
    }

    // Update timers
    function updateCountdowns() {
        const now = new Date().getTime();
        predictions.forEach((p, index) => {
            const distance = p.target.getTime() - now;
            const element = document.getElementById(p.id);

            if (element && !p.crashed) {
                if (distance < 0) {
                    element.innerText = "ACTIVE";
                    element.style.color = "var(--green)";
                    const predEl = document.getElementById(`pred-${p.target.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}`);
                    if (predEl && !predEl.classList.contains('active-window')) {
                        predEl.classList.add('active-window');
                        predEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                    const mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const secs = Math.floor((distance % (1000 * 60)) / 1000);
                    element.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
            }
        });
    }

    // Main update loop
    setInterval(() => {
        const now = new Date();
        document.getElementById('liveClock').innerText = now.toLocaleTimeString('en-GB');
        document.getElementById('offlineOverlay').style.display = navigator.onLine ? "none" : "flex";
        updateCountdowns();
    }, 1000);
</script>
</body>
</html>